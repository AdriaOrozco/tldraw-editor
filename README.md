## Installation

Before running the project, make sure to install all dependencies:

```bash
npm install
```

## Environment Variables

To fetch the data from the endpoint, make sure to specify the local URL where
the app is running. By default, [http://localhost:3000].

1. Create a [.env] file
2. Add your local URL as specified in the [.env.example] file.

## Run the project

First, run the development server:

```bash
npm run dev
# or
yarn dev
# or
pnpm dev
# or
bun dev
```

Open [http://localhost:3000](http://localhost:3000) with your browser to see the
result.

## Design Decisions

To add a button that modifies a shape, two different approaches were chosen:

1.  A new tool was added to the toolbar that works as follows:

    1.1. Creates a shape on the canvas (Square, Rectangle, Triangle, etc.)

    1.2. Click on the new toolbar icon
    <img src="assets/shape-edit-icon.svg" alt="Edit shape icon" width="24" height="24" />

    1.3. With the tool selected, click as many times as needed on the created
    shape to change its form.

2.  A Sidebar has been created that shows the components in real time:

    2.1.Create a shape on the canvas (Square, Rectangle, Triangle, etc.)

    2.2. Locate the shape in the Sidebar and click the icon that appears next to
    the text.

    2.3. Select 'Change Shape' from the dropdown menu.

**Note:** Text or manually drawn shapes cannot be modified in shape using these
tools.

**Loading Feedback**  
A deliberate 1-second delay has been added to the editor fetch request to ensure
the loading component is briefly visible, letting users know the app is
working.".

## Project Structure

The project is organized into the following folders and files:

- **/app** The `app` directory contains:

      - **`page.tsx`**: Each file in this directory corresponds to a route in the application. For example, `app/page.tsx` would correspond to the root (`/`) of the site.

      - **`layout.tsx`**: Defines the layout for the corresponding route.

      - **`error.tsx`** or **`error.js`**: Handles error boundaries for specific routes, allowing you to display custom error pages when something goes wrong in that part of the application.

      - **`loading.tsx`**: Used to display loading states when data is being fetched or the page is in the process of rendering.

      - **`api/editor`**: This folder contains Next.js built-in API routes to handle server-side requests. Next.js allows you to define API routes within the `app/api` directory. Each file in this folder defines a specific API endpoint for handling HTTP requests such as `GET`, `POST`, etc.

      - **`api/trpc/`**: This folder contains files for **tRPC** setup and procedures, ensuring that the requests are type-safe.

- **/assets**: Contains images, icons, and other static files used throughout
  the app.

- **/components**: Contains React components that are responsible for rendering
  UI elements like the sidebar and the TLDraw Editor.

  - **`ui/`**: This is a subfolder within `components/` that contains components
    automatically generated by **shadcn**. **shadcn**

- **/public**: Stores public static files like the favicon and others that need
  to be publicly accessible.

- **/utils**: This folder contains utility functions that are used multiple
  times throughout the project.

  - **`ShapeEditorTool.ts`**: A class used to extend the functionality of tools
    within the app. This class is specifically used to manage and modify shapes
    on the canvas. It allows the user to interact with and change the shape of
    existing shapes.

- **/fake-bd**: A simulated "database" folder containing a JSON file
  (`data.json`) that stores shapes data in a persistent way. This is used to
  load and save data locally.

- **/constants**: This folder contains constant variables used throughout the
  project, particularly for the **tldraw** tools.

- **/context**: This folder creates a React context used for the sidebar,
  storing the state of the tldraw editor so that its features can be accessed
  from outside the Editor component

- **/hooks**: This folder contains custom React hooks that encapsulate reusable
  logic, making it easier to manage state, side effects, and interactions across
  the application.

## Test API endpoints

You can use tools like `curl`, Postman o Thunder Client.

In the root directory of the project, there is a folder called fake-bd. This
folder is automatically created the first time data is saved to the application.

The fake-bd folder simulates a simple database. It stores a file called
data.json that contains the store used by the editor.

data.json is where the data is loaded from when the application starts and saved
to when there are changes.

## Get store

```bash
curl http://localhost:3000/api/editor/get
```

## Save store

```bash
curl -X POST http://localhost:3000/api/editor/post \
  -H "Content-Type: application/json" \
  -d '{
    "document": {
        "store": {
            "document:document": {
                "gridSize": 10,
                "name": "",
                "meta": {},
                "id": "document:document",
                "typeName": "document"
            },
            "page:page": {
                "meta": {},
                "id": "page:page",
                "name": "Page 1",
                "index": "a1",
                "typeName": "page"
            },
            "shape:2OJYxdpr8xF_DX6mNwwSc": {
                "x": 353.6484375,
                "y": 149.63671875,
                "rotation": 0,
                "isLocked": false,
                "opacity": 1,
                "meta": {},
                "id": "shape:2OJYxdpr8xF_DX6mNwwSc",
                "type": "geo",
                "props": {
                    "w": 93.46484375,
                    "h": 103.73046875,
                    "geo": "rectangle",
                    "color": "black",
                    "labelColor": "black",
                    "fill": "none",
                    "dash": "draw",
                    "size": "m",
                    "font": "draw",
                    "align": "middle",
                    "verticalAlign": "middle",
                    "growY": 0,
                    "url": "",
                    "scale": 1,
                    "richText": {
                        "type": "doc",
                        "content": [
                            {
                                "type": "paragraph"
                            }
                        ]
                    }
                },
                "parentId": "page:page",
                "index": "a1",
                "typeName": "shape"
            }
        },
        "schema": {
            "schemaVersion": 2,
            "sequences": {
                "com.tldraw.store": 4,
                "com.tldraw.asset": 1,
                "com.tldraw.camera": 1,
                "com.tldraw.document": 2,
                "com.tldraw.instance": 25,
                "com.tldraw.instance_page_state": 5,
                "com.tldraw.page": 1,
                "com.tldraw.instance_presence": 6,
                "com.tldraw.pointer": 1,
                "com.tldraw.shape": 4,
                "com.tldraw.asset.bookmark": 2,
                "com.tldraw.asset.image": 5,
                "com.tldraw.asset.video": 5,
                "com.tldraw.shape.group": 0,
                "com.tldraw.shape.text": 3,
                "com.tldraw.shape.bookmark": 2,
                "com.tldraw.shape.draw": 2,
                "com.tldraw.shape.geo": 10,
                "com.tldraw.shape.note": 9,
                "com.tldraw.shape.line": 5,
                "com.tldraw.shape.frame": 0,
                "com.tldraw.shape.arrow": 5,
                "com.tldraw.shape.highlight": 1,
                "com.tldraw.shape.embed": 4,
                "com.tldraw.shape.image": 4,
                "com.tldraw.shape.video": 2,
                "com.tldraw.binding.arrow": 0
            }
        }
    },
    "session": {
        "version": 0,
        "currentPageId": "page:page",
        "exportBackground": true,
        "isFocusMode": false,
        "isDebugMode": false,
        "isToolLocked": false,
        "isGridMode": false,
        "pageStates": [
            {
                "pageId": "page:page",
                "camera": {
                    "x": 0,
                    "y": 0,
                    "z": 1
                },
                "selectedShapeIds": [
                    "shape:2OJYxdpr8xF_DX6mNwwSc"
                ],
                "focusedGroupId": null
            }
        ]
    }
}'
```
